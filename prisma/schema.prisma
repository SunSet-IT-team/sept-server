generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
enum Role {
  ADMIN
  CUSTOMER
  EXECUTOR
}

// –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
enum OrderStatus {
  PENDING // –û–∂–∏–¥–∞–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
  IN_PROGRESS // –ü—Ä–∏–Ω—è—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º
  COMPLETED // –ó–∞–≤–µ—Ä—à—ë–Ω —Å –æ—Ç—á—ë—Ç–æ–º
  CANCELLED // –û—Ç–∫–ª–æ–Ω—ë–Ω
}

// üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      Role     @default(CUSTOMER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  executorProfile ExecutorProfile?
  customerProfile CustomerProfile?

  ordersAsCustomer Order[]    @relation("CustomerOrders")
  ordersAsExecutor Order[]    @relation("ExecutorOrders")
  favorites        Favorite[] @relation("FavoriteCustomer")
  favoritedBy      Favorite[] @relation("FavoriteExecutor")
}

// –ü—Ä–æ—Ñ–∏–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
model ExecutorProfile {
  id     Int    @id @default(autoincrement())
  userId Int    @unique
  city   String

  user User @relation(fields: [userId], references: [id])
}

// –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–∫–∞–∑—á–∏–∫–∞
model CustomerProfile {
  id      Int     @id @default(autoincrement())
  userId  Int     @unique
  address String?

  user User @relation(fields: [userId], references: [id])
}

// –£—Å–ª—É–≥–∏
model Service {
  id       Int    @id @default(autoincrement())
  name     String
  priority Int    @default(100)

  orders Order[]
}

// –ó–∞–∫–∞–∑—ã
model Order {
  id         Int  @id @default(autoincrement())
  customerId Int
  executorId Int? // null ‚Äî –ø–æ–∫–∞ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω
  serviceId  Int

  city        String
  description String
  report      String? // –¥–ª—è –æ—Ç—á—ë—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è

  status    OrderStatus @default(PENDING)
  priority  Int         @default(100)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  customer User    @relation("CustomerOrders", fields: [customerId], references: [id])
  executor User?   @relation("ExecutorOrders", fields: [executorId], references: [id])
  service  Service @relation(fields: [serviceId], references: [id])
  review   Review?

  @@index([status])
  @@index([priority])
}

// –û—Ç–∑—ã–≤—ã –∫ –∑–∞–∫–∞–∑–∞–º
model Review {
  id        Int      @id @default(autoincrement())
  orderId   Int      @unique // 1 –∑–∞–∫–∞–∑ = 1 –æ—Ç–∑—ã–≤
  rating    Int
  comment   String
  createdAt DateTime @default(now())

  order Order @relation(fields: [orderId], references: [id])
}

model Favorite {
  id         Int @id @default(autoincrement())
  customerId Int
  executorId Int

  customer User @relation("FavoriteCustomer", fields: [customerId], references: [id])
  executor User @relation("FavoriteExecutor", fields: [executorId], references: [id])

  @@unique([customerId, executorId]) // –Ω–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –¥–≤–∞–∂–¥—ã
}
